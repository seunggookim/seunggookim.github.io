---
layout: page
title: Grossly Over-Optimising (GOO) algorithm
description: An unnecessarily complicated algorithm to organise a teaching club
importance: 2
tags: nerd
giscus_comments: true
related_publication: false
---

**Problem**: I am trying to organise a teaching club at our institute. The problem is: some postdocs want to teach some topics, some PhD students want to learn other topics, and not everyone can come to the session every month.

What normal people normally would do is just ask around who can teach what, and then make a schedule based on the instructors. But then it's possible that some sessions have no participants (sad instructorsðŸ˜¢) and some participants miss their interested sessions (sad participantsðŸ˜¢). 

In the spirit of [over-engineering](https://en.wikipedia.org/wiki/Over-engineering), I have developed a Grossly Over-Optimising[^1] (GOO) algorithm to solve this problem. The algorithm is designed to maximise the utilitarian utility of a community (i.e., the sum of the utilities of all individuals).


## 0. Theory

### 0.1. Definition
Basic units are defined as follows:

- _Session_: a specified time and place to teach and learn a topic.

- _Topic_: a subject for the session.

- _Instructor_: a person who teaches the topic.

- _Participant_: a person who learns the topic.

Let's say we have multiple rectangular binary matrices that code:

- which instructor wants to teach which topic: Â 
$\mathbf{T}$ <\#Instructors x \#Topics>

- which instructor can come in which month: $\mathbf{N}$ <#Instructors x #Topics>

- which participant wants to learn which topic: $\mathbf{L}$ <#Participants x #Topics>

- which participant can come in which month: $\mathbf{P}$ <#Participants x #Topics>

For simplicity, we discarded topics without any instructors.

### 0.2. Decision

Now we need to figure out who will teach what when, while maximising the sum of happiness of individual members (very utilitarian).

Our decisions on `<when>` `<who>` `<what>` can be coded in two rectangular binary matrices as:

- which month will host which topic:Â  $\mathbf{S}$ <#Months x #Topics>

- which instructor will teach which topic: $\mathbf{A}$ <#Instructors x #Topics>Â 

The Session matrixÂ S has a policy-wiseÂ constraint:

- The sum of each column â‰¤ 1 (one month can host only one topic).

The Assignment matrixÂ A also has policy-wise constraint:

- The sum of each column â‰¤ 1 (one topic is taught by only one instructor).

<!-- - $a(i,j) â‰¤ t(i,j)$ (an instructor can only teach a topic if they want to teach it). -->

These rules were enforced when generating random solutions, so the optimiser only needs to evaluate the utility of legal solutions.

### 0.3. Scheduling

With the given $\mathbf{S}$ and $\mathbf{A}$, we can compute the expected participation matrix $\mathbf{Z}$ <#Months x #Topics>:

$$
\mathbf{Z} = \mathbf{X} âŠ™ \mathbf{Y},
$$

where $\mathbf{X}$ <#Months x #Topics> is the possible teaching schedule matrix (combining interest, availability, and assignment):

$$
\mathbf{X} = \mathbf{N}'(\mathbf{T} âŠ™ \mathbf{A}),Â  
$$


and $\mathbf{Y}$ <#Months x #Topics> is the possible participation schedule matrix (combining interest, availability, and assignment):

$$
\mathbf{Y} = (\mathbf{P}'\mathbf{L}) âŠ™ \mathbf{S}.
$$

**chatGPT-assisted explanation:**
> Let's break down these computations: first we compute the element-wise product of the interest matrix $\mathbf{T}$ and the assignment matrix $\mathbf{A}$. You can think this element-wise product as a filter that only keeps the topics that are assigned to instructors who are interested in teaching them. Now if you multiply the transpose of the availability matrix $\mathbf{N}$ with this filtered matrix, you get the possible teaching matrix $\mathbf{X}$, which counts how many instructors are available to teach each topic in each month. Because we have the constraint that one topic can only be taught by one instructor, the possible teaching matrix $\mathbf{X}$ will have the same values as the filtered matrix $\mathbf{T} âŠ™ \mathbf{A}$, but with the rows (months) summed up according to the availability of instructors.
>
> Now, as for the possible participation matrix $\mathbf{Y}$, we first compute the product of the transpose of the availability matrix $\mathbf{P}$ and the interest matrix $\mathbf{L}$. This gives us a matrix that counts how many participants are interested in each topic in each month. Then, by applying the element-wise product with the session matrix $\mathbf{S}$, we filter this matrix to only keep the topics that are scheduled for sessions. This results in the possible participation matrix $\mathbf{Y}$, which counts how many participants are interested and able to attend each topic in each month.
>
> Finally, the element-wise product of $\mathbf{X}$ and $\mathbf{Y}$ gives us the matrix $\mathbf{Z}$, which counts how many participants are interested and able to attend each topic in each month, given the teaching schedule and the assignment of instructors to topics. Once again, you can think of this as a filter that only keeps the topics that are both taught and scheduled for sessions, and counts how many participants can attend those sessions.

Now that the chatGPT noted, I realised that $\mathbf{A}$ can be constructed without the second constraint but still can find an optimal solution, because the illegal assignment will be filtered out by the interest matrix $\mathbf{T}$ when computing $\mathbf{X}$.

Here, $âŠ™$ denotes the element-wise (Hadamard) product, and the prime ($'$) denotes matrix transposition.

That is, the utility can be expanded as:

$$
U = Î¶[ {N'(T âŠ™ A)} âŠ™ {(P'L) âŠ™ S}, w ].
$$

### 0.4. Utility function

#### 0.4.1. Participant utility

The aggregated utility of all participants is defined as the sum of the number of participants over all months.

Say we have a rectangular matrix:Â $\mathbf{Z}$ <#Months x #Topics> with the number of interested participants who are able to come as its elements. Then the utility is defined as

$$
U = Î¶(\mathbf{Z}) =Â \sum_{i,j} z(i,j),
$$

in a unit of _"a person's happiness"_. Based on the utilitarian view, every individual has an equal contribution to the community-level utility.

#### 0.3.2. Instructor utility

Now, we have only considered the utility of participants, but what about the instructors? To keep it simple, we can assume that an instructor has a step utility function: they get 1 happiness if they teach at least one topic, and 0 otherwise:

$$
V = Ï‡(\mathbf{A}) =Â \sum_i H(||\mathbf{a}_i||_1-1),
$$

where $H(x)$ is the Heaviside step function (i.e., $H(x) = 1$ if $x \geq 0$, and $H(x) = 0$ otherwise) and $||.||_1$ denotes L1 norm. 

Finally, the total utility is the sum of the participant utility and the instructor utility:

$$
W = U + V.
$$


#### 0.4.3 Future discount

Classically, (British) economists have argued that it is not a sin for banks to take interest (for loans that funded piracy/colonial business) by theorising "future discount".ðŸ’° While its historical application is morally ambiguous, the notion that "future uncertainty should be addressed"ðŸ’¸ may still be valid even for our cause, simply because we have less information about events in the distant future. ðŸ”® (That is, it may be reasonable to think that a marshmallow promised in 15 minutes is not really 1 marshmallow but 0.9 marshmallows, because that mean psychologist might eat up everything in the meantime!; See: <https://en.wikipedia.org/wiki/Stanford_marshmallow_experiment>)

The discount rate is based on the Bundesbank basic rate of interest as of 2026-01-01 ([LINK](https://www.bundesbank.de/en/bundesbank/organisation/gtc-and-legal-basis/basic-rate-of-interest-616708)): 1.27% per annum, which isÂ 0.1058% per mensem.

The discount for the m-th month isÂ $d(m) = (1 - \delta)^{m-1}$Â where $\delta$ is the discount per mensem (here, $\delta=0.1058/100$). Then the discounted participant utility is:

$$
U = Î¶(\mathbf{Z}, \mathbf{d}) =Â \sum_{i,j} z(i,j).d(i),
$$

and the discounted instructor utility is:

[HMM!]
<!-- $$
V = Ï‡(\mathbf{A}, \mathbf{d}) =Â  \sum_i H(||\mathbf{a}_i||_1-1).d(i),
$$ -->



## 1. Optimisation

The universal optimiser (i.e., "try-many-random-legal-solutions-and-find-the-best-one") is used. To ensure reproducibility and avoid storing the entire matrices, a sequence of natural numbers was used as seed values. A reasonable search could have stopped at around 100,000 iterations (3.332 seconds). But GOO is committed to the over-optimisation and was willing to sample more than the total number of possible combinations. So, the search was extended to 10,000,000 iterations (333.550 seconds). "The solution was identical to that with 100,000 iterations and a complete waste of time (nice!)." could have been hilarious, but it turns out that we need this many iterations for this brute-force approach. ðŸ¤·

## 2. Implementation
Because the new version of Julia seems to have some problems with the current MacOS, I implemented the GOO algorithm in MATLAB:

{% tabs goo1 %}
{% tab goo1 matlab %}
```matlab
function [X, Y, S, A, u] = createrandsolution(seed, nMonths, nTopics, nInst, N, T, P, L, w)
rng(seed)
% create only LEGAL S:
S = false(nMonths, nTopics);
assert(nMonths > nTopics)
idx = randperm(nMonths, nTopics);
for j = 1:numel(idx)
  S(idx(j),j) = true;
end

% create only LEGAL A:
A = false(nInst, nTopics);
for jTopic = 1:nTopics
  idx = find(T(:,jTopic));
  idx = idx(randperm(numel(idx)));
  A(idx(1), jTopic) = true;
end

X = N' * (T.*A);   % months x topics
Y = (P'*L) .* S;   % months x topics
Z = X .* Y;

Z = Z .* w'; % apply discount
u = sum(Z(:));

u = u + sum(any(A,2)); % instructors have a step utility function.
end
```
{% endtab %}
{% endtabs %}

Then you just call the function with different seed values and keep the best solution:
```matlab
best_u = -Inf;
for seed = 1:1e7
  [~,~,~,~, u] = createrandsolution(seed, nMonths, nTopics, nInst, N, T, P, L, w);
  if u > best_u
    seed_star = seed;
    u_star = u;
  end
end

[X_star, Y_star, S_star, A_star] = createrandsolution(seed_star, nMonths, nTopics, nInst, N, T, P, L, w);
```

## 3. Results
The random search with 1e7 (ten million) iterations took 358.2 seconds and found a solution with a utility of 24.96 happiness.

| <img alt="goo" src="/assets/img/blog/goo-fig1.png" width="800px" data-zoomable> |
| _Fig 1. An example solution. Names are hashed. Topic names are abbreviated._ |

The optimal assignment ($\mathbf{A}$; e.g., Instructor 4 does three topics) and session schedule ($\mathbf{S}$; those three topics are scheduled in August, April and September) achieves the maximal utility.

---
[^1]: Since the second Trump administraion ("Fool me twice, ..."), I decided to use British spelling instead, because now it feels somehow very awkward.

